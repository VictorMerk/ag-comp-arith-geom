<!-- Metadata, OpenGraph and Schema.org -->
{% include metadata.liquid %}

<!-- Bootstrap & MDB -->
<link rel="stylesheet" href="{{ '/assets/css/bootstrap.min.css' | relative_url | bust_file_cache }}">
<link
  rel="stylesheet"
  href="{{ site.third_party_libraries.mdb.url.css }}"
  crossorigin="anonymous"
>

{% if page.pretty_table %}
  <!-- Bootstrap Table -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.bootstrap-table.url.css }}"
    crossorigin="anonymous"
  >
{% endif %}

<!-- Fonts & Icons -->
<link defer rel="stylesheet" href="{{ '/assets/css/academicons.min.css' | relative_url | bust_file_cache }}">
<link defer rel="stylesheet" href="{{ '/assets/css/scholar-icons.css' | relative_url | bust_file_cache }}">
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<!-- Language Switcher -->
<link rel="stylesheet" href="{{ '/assets/css/flag-icons.css' | relative_url | bust_file_cache }}">
<!-- Google Fonts -->
<link
  defer
  rel="stylesheet"
  type="text/css"
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<!-- Code Syntax Highlighting -->
<link
  defer
  rel="stylesheet"
  href="{{ '/assets/css/jekyll-pygments-themes-github.css' | relative_url | bust_file_cache }}"
  media=""
  id="highlight_theme_light"
>

{% if page.toc and page.toc.sidebar %}
  <!-- Sidebar Table of Contents -->
  <link defer href="{{ '/assets/css/bootstrap-toc.min.css' | relative_url | bust_file_cache }}" rel="stylesheet">
{% endif %}

<!-- Styles -->

{% if page.pseudocode %}
  <!-- pseudocode -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.pseudocode.url.css }}"
    crossorigin="anonymous"
  >
{% endif %}

{% if site.icon.size <= 4 %}
  <link
    rel="shortcut icon"
    href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>{{ site.icon }}</text></svg>"
  >
{% elsif site.icon != blank %}
  <link rel="shortcut icon" href="{{ site.icon | prepend: '/assets/img/' | relative_url | bust_file_cache}}">
{% endif %}
<link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url | bust_css_cache }}">
<link rel="stylesheet" href="{{ '/assets/css/dark-mode.css' | relative_url | bust_css_cache }}">
<link rel="stylesheet" href="{{ '/assets/css/pagescms-dragdrop.css' | relative_url | bust_css_cache }}">

<link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">

<script>
  // Expose baseurl for JS so it can build correct paths on GitHub Pages
  window.__BASEURL__ = {{ site.baseurl | jsonify }};
  window.__SITEURL__ = {{ site.url | jsonify }};
  // Helper to prefix site.baseurl to root-relative paths
  window.prefixBase = function(path) {
    if (!path) return path;
    // External URLs stay as-is
    if (/^https?:\/\//.test(path)) return path;
    // Already relative to base? Return as-is
    if (window.__BASEURL__ && path.startsWith(window.__BASEURL__ + '/')) return path;
    // If starts with '/', prefix baseurl; otherwise return unchanged
    if (path.startsWith('/')) return (window.__BASEURL__ || '') + path;
    return path;
  };
</script>

<!-- Theme Color for Mobile Browsers -->
<meta name="theme-color" content="#C22032" id="theme-color-meta">

<!-- Enhanced Meta Tags -->
<meta name="application-name" content="AG Computational Arithmetic Geometry">
<meta name="msapplication-TileColor" content="#C22032">

<!-- Pages CMS Integration Meta Tags -->
<meta name="repository-url" content="{{ site.pagescms.repo_url | default: site.url }}">
<meta name="repository-branch" content="{{ site.pagescms.branch | default: 'main' }}">

<!-- MathJax for LaTeX support -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      displayMath: [['$$', '$$'], ['\\[', '\\]']],
      processEscapes: true,
      processEnvironments: true
    },
    options: {
      ignoreHtmlClass: 'tex2jax_ignore',
      processHtmlClass: 'tex2jax_process'
    }
  };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="{{ '/assets/js/mathjax-setup.js' | relative_url | bust_file_cache }}"></script>

<!-- Simple, direct theme management -->
<script>
(function() {
  'use strict';

  // Get saved theme or detect system preference
  function getInitialTheme() {
    const saved = localStorage.getItem('theme');
    if (saved === 'light' || saved === 'dark') {
      return saved;
    }
    return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }

  // Apply theme immediately
  function applyTheme(theme) {
    const root = document.documentElement;

    // Remove existing theme classes
    root.classList.remove('light-mode', 'dark-mode');
    root.removeAttribute('data-theme');

    // Apply new theme
    if (theme === 'dark') {
      root.setAttribute('data-theme', 'dark');
      root.classList.add('dark-mode');

      // Set all necessary CSS variables for dark mode
      root.style.setProperty('--primary', '#DC2626');
      root.style.setProperty('--primary-hover', '#B91C1C');
      root.style.setProperty('--primary-text', '#000000');
      root.style.setProperty('--bg-primary', '#000000');
      root.style.setProperty('--text-primary', '#FFFFFF');
      root.style.setProperty('--bg-secondary', '#0A0A0A');
      root.style.setProperty('--text-secondary', '#F3F4F6');
    } else {
      root.setAttribute('data-theme', 'light');
      root.classList.add('light-mode');

      // Set all necessary CSS variables for light mode
      root.style.setProperty('--primary', '#C22032');
      root.style.setProperty('--primary-hover', '#991B1B');
      root.style.setProperty('--primary-text', '#FFFFFF');
      root.style.setProperty('--bg-primary', '#FFFFFF');
      root.style.setProperty('--text-primary', '#000000');
      root.style.setProperty('--bg-secondary', '#F9FAFB');
      root.style.setProperty('--text-secondary', '#111827');
    }

    // Update theme toggle icons
    updateThemeIcons(theme);
  }

  // Update theme toggle icons
  function updateThemeIcons(theme) {
    const lightIcon = document.getElementById('theme-icon-light');
    const darkIcon = document.getElementById('theme-icon-dark');

    if (lightIcon && darkIcon) {
      if (theme === 'dark') {
        lightIcon.style.display = 'inline-block';
        darkIcon.style.display = 'none';
      } else {
        lightIcon.style.display = 'none';
        darkIcon.style.display = 'inline-block';
      }
    }
  }

  // Initialize theme immediately
  const initialTheme = getInitialTheme();
  applyTheme(initialTheme);

  // Simple theme toggle function
  window.toggleTheme = function() {
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';

    // Apply the theme
    applyTheme(newTheme);

    // Save to localStorage
    localStorage.setItem('theme', newTheme);

    console.log('Theme switched to:', newTheme);
  };

  // Also update icons on DOMContentLoaded for initial state
  document.addEventListener('DOMContentLoaded', function() {
    const currentTheme = getInitialTheme();
    updateThemeIcons(currentTheme);
  });

  // Bind toggle when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    const toggleBtn = document.getElementById('theme-toggle');
    if (toggleBtn) {
      toggleBtn.addEventListener('click', function(e) {
        e.preventDefault();
        window.toggleTheme();
      });
      console.log('Theme toggle bound successfully');
    } else {
      console.error('Theme toggle button not found');
    }
  });

})();
</script>
{% if site.enable_darkmode %}
  <link
    defer
    rel="stylesheet"
    href="{{ '/assets/css/jekyll-pygments-themes-native.css' | relative_url | bust_file_cache }}"
    media="none"
    id="highlight_theme_dark"
  >

{% endif %}

{% if page.map %}
  <!-- GeoJSON support via Leaflet -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.leaflet.url.css }}"
    crossorigin="anonymous"
  >
{% endif %}

{% if page.code_diff %}
  <!-- diff2html -->
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.highlightjs.url.css.light }}"
    crossorigin="anonymous"
    media="screen and (prefers-color-scheme: light)"
  >
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.highlightjs.url.css.dark }}"
    crossorigin="anonymous"
    media="screen and (prefers-color-scheme: dark)"
  >
  <link
    defer
    rel="stylesheet"
    href="{{ site.third_party_libraries.diff2html.url.css }}"
    crossorigin="anonymous"
  >
{% endif %}

{% if page.images %}
  {% if page.images.compare %}
    <!-- Image comparison slider -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.img-comparison-slider.url.css }}"
      crossorigin="anonymous"
    >
  {% endif %}
  {% if page.images.lightbox2 %}
    <!-- Lightbox2 -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.lightbox2.url.css }}"
      crossorigin="anonymous"
    >
  {% endif %}
  {% if page.images.photoswipe %}
    <!-- Photoswipe -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.photoswipe.url.css }}"
      crossorigin="anonymous"
    >
  {% endif %}
  {% if page.images.slider %}
    <!-- Image slider -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.swiper.url.css }}"
      crossorigin="anonymous"
    >
  {% endif %}
  {% if page.images.spotlight %}
    <!-- Spotlight -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.spotlight.url.css }}"
      crossorigin="anonymous"
    >
  {% endif %}
  {% if page.images.venobox %}
    <!-- Venobox -->
    <link
      defer
      rel="stylesheet"
      href="{{ site.third_party_libraries.venobox.url.css }}"
      crossorigin="anonymous"
    >
  {% endif %}
{% endif %}

{% if page.tikzjax %}
  <link defer rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
{% endif %}
